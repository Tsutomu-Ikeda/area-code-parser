# area-code-parser

## これは何

[総務省が公開している全国の市外局番一覧](https://www.soumu.go.jp/main_sosiki/joho_tsusin/top/tel_number/shigai_list.html)のPDFファイルをいい感じにパースするもの

## 使い方

サーバーの起動

```bash
docker-compose build
docker-compose up -d
```

PDFのパース(HTTPieを使った例)

```
http --form POST localhost:8080/parse pdf_file@~/Downloads/市外局番.pdf > result.json
```

出力例

```bash
cat out.json | jq | head -n20
[
  {
    "番号区画コード": "1",
    "番号区画": [
      {
        "name": "北海道江別市"
      },
      {
        "name": "北海道札幌市"
      },
      {
        "name": "北海道北広島市"
      },
      {
        "name": "北海道空知郡南幌町"
      }
    ],
    "市外局番": "11",
    "市内局番": "CDE"
  },
```

`~/Downloads/市外局番.pdf` は適宜置き換えてください。

## 機能

- 日本語で記述された番号区画コードをJSON形式に変換する

例)

```
東京都２３区、狛江市（西和泉を除く。）、調布市（入間町、国領町八丁目、仙川町、西つつじヶ丘二丁目、東つつじヶ丘、緑ヶ丘及び若葉町に限る。）、三鷹市中原一丁目
```

```json
[
    {"name": "東京都２３区"},
    {
        "name": "東京都狛江市",
        "exclude": [{"name": "西和泉"}],
        "include": []
    },
    {
        "name": "東京都調布市",
        "exclude": [],
        "include": [
            {"name": "入間町"},
            {"name": "国領町八丁目"},
            {"name": "仙川町"},
            {"name": "西つつじヶ丘二丁目"},
            {"name": "東つつじヶ丘"},
            {"name": "緑ヶ丘"},
            {"name": "若葉町"}
        ]
    },
    {"name": "東京都三鷹市中原一丁目"}
]
```

`西原町二丁目から四丁目まで` を `西原町二丁目` `西原町三丁目` `西原町四丁目` に展開する機能もついています。

```
東京都稲城市、小金井市（梶野町一丁目から四丁目まで並びに東町二丁目及び三丁目を除く。）、国分寺市（高木町、内藤、西町、光町、日吉町二丁目及び三丁目、富士本並びに戸倉三丁目を除く。）、小平市（鈴木町二丁目、花小金井及び花小金井南町を除く。）、多摩市、東村山市、府中市（押立町四丁目及び五丁目、北山町、西原町二丁目から四丁目まで並びに西府町四丁目を除く。）
```

```json
[
    {"name": "東京都稲城市"},
    {
        "name": "東京都小金井市",
        "exclude": [
            {"name": "梶野町一丁目"},
            {"name": "梶野町二丁目"},
            {"name": "梶野町三丁目"},
            {"name": "梶野町四丁目"},
            {"name": "東町二丁目"},
            {"name": "東町三丁目"}
        ],
        "include": []
    },
    {
        "name": "東京都国分寺市",
        "exclude": [
            {"name": "高木町"},
            {"name": "内藤"},
            {"name": "西町"},
            {"name": "光町"},
            {"name": "日吉町二丁目"},
            {"name": "日吉町三丁目"},
            {"name": "富士本"},
            {"name": "戸倉三丁目"}
        ],
        "include": []
    },
    {
        "name": "東京都小平市",
        "exclude": [
            {"name": "鈴木町二丁目"},
            {"name": "花小金井"},
            {"name": "花小金井南町"}
        ],
        "include": []
    },
    {"name": "東京都多摩市"},
    {"name": "東京都東村山市"},
    {
        "name": "東京都府中市",
        "exclude": [
            {"name": "押立町四丁目"},
            {"name": "押立町五丁目"},
            {"name": "北山町"},
            {"name": "西原町二丁目"},
            {"name": "西原町三丁目"},
            {"name": "西原町四丁目"},
            {"name": "西府町四丁目"}
        ],
        "include": []
    }
]
```

多重の階層構造にも対応しています。

```
大阪府東大阪市（旭町、岩田町（三丁目を除く。）、瓜生堂一丁目及び若草町を除く。）
```

(元のテキストが長いので一部のみ抜粋)

```json
[
    {
        "name": "大阪府東大阪市",
        "exclude": [
            {
                "name": "旭町"
            },
            {
                "name": "岩田町",
                "exclude": [
                    {
                        "name": "三丁目"
                    }
                ],
                "include": []
            },
            {
                "name": "瓜生堂一丁目"
            },
            {
                "name": "若草町"
            }
        ],
        "include": []
    }
]
```

## 既知の問題

- 番号区画498・499と番号区画577・578については発信方法によって番号区画をまたぐケースがあるが、市外局番自体は変わらないため、無視してパースをしている。
